{"ast":null,"code":"import { assign, reject } from 'lodash';\nimport { DesignerDocumentTypes, FlowPortType } from './models';\n/*\r\n  Estoy modelando lo que hago en el designer dentro del prototipo\r\n\r\n  Debo agregar un tipo de documento \"FLOW\"\r\n\r\n  El componente encargado de llamar al designer, debe transformar la lista de\r\n  grupos dinámicos en bloques + connections + layout.\r\n\r\n  Las connections se pueden sacar a partir de los grupos dinámicos, dónde:\r\n  * Cada grupo-dinámico está conectado con sus acciones\r\n  * El goto del expiración define al próximo nodo que se conecta\r\n  * El goto del onExit define a qué nodo se conecta\r\n\r\n  El layout debe guardarse en la entidad flujo.\r\n\r\n  Los bloques son parte del body en el designer,\r\n  y el layout + connections es parte de la configuración del documento\r\n\r\n  Casos desde parent:\r\n    Cargar distintas conexiones  -> configuration\r\n    Agregar / Eliminar bloque    -> configuration + blocks\r\n    Cargar distintos bloques     -> configuration + blocks\r\n\r\n  Casos desde usuario:\r\n    Mover bloque                 -> configuration\r\n    Agregar conexion             -> configuration\r\n    Eliminar conexion            -> configuration\r\n\r\n*/\n/*\r\n  // @@@@ Estoy aqui\r\n\r\n\r\n  // TODO: Convertir blocks+configuration en grupos dinámicos\r\n  //       Una vez que se valide el flujo debo convertirlo\r\n  //       en un conjunto de grupos dinámicos\r\n\r\n\r\n  El extractCheckpoints genera los grupos dinámicos casi listos para procesarlos\r\n  Sólo devuelve ids de bloques y se deben mapear a los datos de cada bloque\r\n  Y aplicar las reglas para guardar en el backend\r\n\r\n  Moví las funciones a flow-validators, y ahora sólo se exponen dos funciones\r\n  validate\r\n  getCheckpointCentric\r\n\r\n  Ahora debería ordenarla un pelo\r\n\r\n  Debería cambiar nombre a flowValidator por flowUtil\r\n\r\n\r\n  // TODO: Cambiar el tipo de bloque desde NODE a CHECKPOINT\r\n  //       en teoría de graphs todos los nodos son nodes...\r\n  //       y es confuso llamar a un tipo con el genérico\r\n  \r\n\r\n\r\n  // TODO: Hacer más compactos los bloques de los bloques\r\n  //       Utilicé esta paleta:\r\n  //       https://coolors.co/abe188-f7ef99-f1bb87-f78e69-5d675b\r\n\r\n  //       Algunas ideas de diagramas\r\n  //       https://visme.co/blog/flowchart-examples/\r\n\r\n\r\n\r\n*/\n// TODO: @Optional: Implementar contador de paths\n//       Se podría poner en las propiedades los paths que tiene un flujo\n//       y se podrían resaltar en el inspector del flujo\n//       Me parece un dato interesante\n//       y que permite al usuario saber los caminos que a lo mejor no se ven a simple vista\n// TODO: @Optional Implementar un drag para hacer el panning\n//       Creo que se puede hacer más o moenos fácil con esto:\n//       https://github.com/kmturley/touch-scroll/blob/master/js/TouchScroll.js\n// TODO: @Server Agregar etiquetas a entidad flujo\n//       para facilitar las búsquedas y poder agruparlas fácilmente\n// TODO: Importar esto desde el componente flow-designer\nimport * as flow from './flow-validators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"./designer-render/designer-render.component\";\nfunction AppComponent_div_66_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const item_r10 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", item_r10.missing, \" bloque del tipo \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r10.type);\n  }\n}\nfunction AppComponent_div_66_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, AppComponent_div_66_div_2_Template, 4, 2, \"div\", 17);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Faltan \", ctx_r0.configuration.errors.minimunBlocks.length, \" tipos de bloques: \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.configuration.errors.minimunBlocks);\n  }\n}\nfunction AppComponent_div_67_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵlistener(\"mouseover\", function AppComponent_div_67_div_2_Template_div_mouseover_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r15);\n      const list_r12 = restoredCtx.$implicit;\n      const ctx_r14 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r14.focusBlocks(list_r12));\n    })(\"mouseout\", function AppComponent_div_67_div_2_Template_div_mouseout_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r15);\n      const list_r12 = restoredCtx.$implicit;\n      const ctx_r16 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r16.unfocusBlocks(list_r12));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const $index_r13 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Resaltar grupo \", $index_r13 + 1, \" \");\n  }\n}\nfunction AppComponent_div_67_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, AppComponent_div_67_div_2_Template, 2, 1, \"div\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.configuration.errors.uniqueComponent.length, \" grupos de bloques que no est\\u00E1n conectados \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.configuration.errors.uniqueComponent);\n  }\n}\nfunction AppComponent_div_68_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵlistener(\"mouseover\", function AppComponent_div_68_div_2_Template_div_mouseover_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r21);\n      const list_r18 = restoredCtx.$implicit;\n      const ctx_r20 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r20.focusBlocks(list_r18));\n    })(\"mouseout\", function AppComponent_div_68_div_2_Template_div_mouseout_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r21);\n      const list_r18 = restoredCtx.$implicit;\n      const ctx_r22 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r22.unfocusBlocks(list_r18));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const $index_r19 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Resaltar ciclo \", $index_r19 + 1, \" \");\n  }\n}\nfunction AppComponent_div_68_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, AppComponent_div_68_div_2_Template, 2, 1, \"div\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.configuration.errors.acyclic.length, \" grupo de conectados circularmente \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.configuration.errors.acyclic);\n  }\n}\nfunction AppComponent_div_69_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r27 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵlistener(\"mouseover\", function AppComponent_div_69_div_2_Template_div_mouseover_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r27);\n      const list_r24 = restoredCtx.$implicit;\n      const ctx_r26 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r26.focusBlocks(list_r24));\n    })(\"mouseout\", function AppComponent_div_69_div_2_Template_div_mouseout_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r27);\n      const list_r24 = restoredCtx.$implicit;\n      const ctx_r28 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r28.unfocusBlocks(list_r24));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const $index_r25 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Resaltar Bloque de Espera \", $index_r25 + 1, \" \");\n  }\n}\nfunction AppComponent_div_69_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, AppComponent_div_69_div_2_Template, 2, 1, \"div\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" S\\u00F3lo puede existir un bloque de espera en la entrada. Actualmente hay \", ctx_r3.configuration.errors.uniqueEntryNode.length, \" bloques de espera conectados con el inicio \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.configuration.errors.uniqueEntryNode);\n  }\n}\nfunction AppComponent_div_70_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r33 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵlistener(\"mouseover\", function AppComponent_div_70_div_2_Template_div_mouseover_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r33);\n      const list_r30 = restoredCtx.$implicit;\n      const ctx_r32 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r32.focusEdge(list_r30));\n    })(\"mouseout\", function AppComponent_div_70_div_2_Template_div_mouseout_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r33);\n      const list_r30 = restoredCtx.$implicit;\n      const ctx_r34 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r34.unfocusBlocks(list_r30));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const $index_r31 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Resaltar conexi\\u00F3n inv\\u00E1lida \", $index_r31 + 1, \" \");\n  }\n}\nfunction AppComponent_div_70_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, AppComponent_div_70_div_2_Template, 2, 1, \"div\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Existen \", ctx_r4.configuration.errors.connections.length, \" que no permitidas. \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.configuration.errors.connections);\n  }\n}\nfunction AppComponent_div_71_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r39 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵlistener(\"mouseover\", function AppComponent_div_71_div_2_Template_div_mouseover_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r39);\n      const list_r36 = restoredCtx.$implicit;\n      const ctx_r38 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r38.focusBlocks(list_r36));\n    })(\"mouseout\", function AppComponent_div_71_div_2_Template_div_mouseout_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r39);\n      const list_r36 = restoredCtx.$implicit;\n      const ctx_r40 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r40.unfocusBlocks(list_r36));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const $index_r37 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Resaltar ruta sin bloque de espera \", $index_r37 + 1, \" \");\n  }\n}\nfunction AppComponent_div_71_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, AppComponent_div_71_div_2_Template, 2, 1, \"div\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Todos las rutas deben tener al menos un bloque de espera. Existen \", ctx_r5.configuration.errors.nodeInEveryRoute.length, \" que no tienen un bloque de espera. \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r5.configuration.errors.nodeInEveryRoute);\n  }\n}\nfunction AppComponent_div_72_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r45 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵlistener(\"mouseover\", function AppComponent_div_72_div_2_Template_div_mouseover_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r45);\n      const list_r42 = restoredCtx.$implicit;\n      const ctx_r44 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r44.focusBlocks(list_r42));\n    })(\"mouseout\", function AppComponent_div_72_div_2_Template_div_mouseout_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r45);\n      const list_r42 = restoredCtx.$implicit;\n      const ctx_r46 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r46.unfocusBlocks(list_r42));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const $index_r43 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Resaltar bloque \", $index_r43 + 1, \" \");\n  }\n}\nfunction AppComponent_div_72_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, AppComponent_div_72_div_2_Template, 2, 1, \"div\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Los nodos de Inicio son los \\u00FAnicos que pueden estar al comienzo del flujo. Existen \", ctx_r6.configuration.errors.validSources.length, \" bloques que est\\u00E1n al comienzo. \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r6.configuration.errors.validSources);\n  }\n}\nfunction AppComponent_div_73_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r51 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵlistener(\"mouseover\", function AppComponent_div_73_div_2_Template_div_mouseover_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r51);\n      const list_r48 = restoredCtx.$implicit;\n      const ctx_r50 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r50.focusBlocks(list_r48));\n    })(\"mouseout\", function AppComponent_div_73_div_2_Template_div_mouseout_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r51);\n      const list_r48 = restoredCtx.$implicit;\n      const ctx_r52 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r52.unfocusBlocks(list_r48));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const $index_r49 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Resaltar bloque \", $index_r49 + 1, \" \");\n  }\n}\nfunction AppComponent_div_73_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, AppComponent_div_73_div_2_Template, 2, 1, \"div\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Los nodos de Fin son los \\u00FAnicos que pueden estar al final del flujo. Existen \", ctx_r7.configuration.errors.validSinks.length, \" bloques que est\\u00E1n al final. \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r7.configuration.errors.validSinks);\n  }\n}\nfunction AppComponent_div_74_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r57 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵlistener(\"mouseover\", function AppComponent_div_74_div_2_Template_div_mouseover_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r57);\n      const list_r54 = restoredCtx.$implicit;\n      const ctx_r56 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r56.focusBlocks(list_r54));\n    })(\"mouseout\", function AppComponent_div_74_div_2_Template_div_mouseout_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r57);\n      const list_r54 = restoredCtx.$implicit;\n      const ctx_r58 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r58.unfocusBlocks(list_r54));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const $index_r55 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Resaltar bloque \", $index_r55 + 1, \" \");\n  }\n}\nfunction AppComponent_div_74_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, AppComponent_div_74_div_2_Template, 2, 1, \"div\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Los bloques de espera deben tener expiraci\\u00F3n. Existen \", ctx_r8.configuration.errors.expiration.length, \" bloques que no tienen expiraci\\u00F3n. \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r8.configuration.errors.expiration);\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    /*\r\n      blocks = [];\r\n      configuration = {\"title\":\"Primer flujo\",\"owner\":\"roberto\",\"layout\":{},\"zoom\":1,\"connections\":[], edges: []};\r\n    */\n    constructor() {\n      this.blocks = [{\n        uuid: 'start_989',\n        class: 'flow.start'\n      }, {\n        uuid: 'signal_b46a17',\n        class: 'flow.signal',\n        title: 'Contacto llenó formulario \"cita\"'\n      }, {\n        uuid: 'action_2eb091',\n        class: 'flow.action',\n        title: 'Enviar correo Cotizacion'\n      }, {\n        uuid: 'node_efd2ce',\n        class: 'flow.node',\n        title: 'Consentidos',\n        expireTime: 10\n      }, {\n        uuid: 'end_989',\n        class: 'flow.end'\n      }];\n      this.configuration = {\n        id: 'xxxx',\n        title: 'Primer flujo',\n        status: 'DRAFT',\n        type: DesignerDocumentTypes.FLOW,\n        owner: 'roberto',\n        connectorType: 'FLOWCHART',\n        zoom: 1,\n        themeCss: 'basic-plain',\n        layout: {\n          'start_989': {\n            top: 0,\n            left: 300\n          },\n          'signal_b46a17': {\n            top: 88,\n            left: 66\n          },\n          'action_2eb091': {\n            top: 330,\n            left: 198\n          },\n          'node_efd2ce': {\n            top: 400,\n            left: 618\n          },\n          'end_989': {\n            top: 550,\n            left: 550\n          }\n        },\n        edges: [{\n          source: {\n            uuid: 'start_989',\n            port: FlowPortType.out\n          },\n          target: {\n            uuid: 'signal_b46a17',\n            port: FlowPortType.in\n          }\n        }, {\n          source: {\n            uuid: 'signal_b46a17',\n            port: FlowPortType.out\n          },\n          target: {\n            uuid: 'action_2eb091',\n            port: FlowPortType.in\n          }\n        }, {\n          source: {\n            uuid: 'action_2eb091',\n            port: FlowPortType.out\n          },\n          target: {\n            uuid: 'node_efd2ce',\n            port: FlowPortType.in\n          }\n        }, {\n          source: {\n            uuid: 'node_efd2ce',\n            port: FlowPortType.expiration\n          },\n          target: {\n            uuid: 'end_989',\n            port: FlowPortType.in\n          }\n        }],\n        errors: {},\n        focused: []\n      };\n    }\n    ngOnInit() {}\n    insertBlock($event) {\n      const newBlock = Object.assign(Object.assign({}, $event.block), {\n        uuid: this.generateUuid()\n      });\n      /** Actualizamos el layout */\n      const newBlockLayout = {\n        top: 0,\n        left: 0\n      };\n      this.configuration.layout = Object.assign(this.configuration.layout, {\n        [newBlock.uuid]: newBlockLayout\n      });\n      this.blocks = this.blocks.slice().concat([newBlock]);\n    }\n    deleteBlock($event) {\n      console.log('Abuelo eliminando block-->', $event);\n      this.blocks = reject(this.blocks, b => b.uuid === $event.block.uuid);\n    }\n    generateUuid() {\n      return Math.random().toString(16).slice(2, 8);\n    }\n    save() {\n      const configuration = JSON.stringify(this.configuration);\n      console.log('GUARDANDO CONFIGURATION-->');\n      console.log(configuration);\n      const blocks = JSON.stringify(this.blocks);\n      console.log('BLOCKS-->');\n      console.log(blocks);\n      localStorage.setItem('lastFlow', configuration);\n      localStorage.setItem('lastBlocks', blocks);\n    }\n    loadFromStorage() {\n      this.resetData();\n      // setTimeout ( () => {\n      const lastConfiguration = localStorage.getItem('lastFlow');\n      const lastBlocks = localStorage.getItem('lastBlocks');\n      if (!lastConfiguration || !lastBlocks) {\n        console.warn('No encontré ultima configuration o bloques');\n        return;\n      }\n      this.configuration = JSON.parse(lastConfiguration);\n      this.blocks = JSON.parse(lastBlocks);\n      // })\n    }\n\n    resetData() {\n      this.blocks = [];\n      this.configuration = {\n        id: '',\n        themeCss: 'basic-plain',\n        connectorType: \"FLOWCHART\",\n        status: 'DRAFT',\n        title: \"Primer flujo\",\n        type: DesignerDocumentTypes.FLOW,\n        owner: \"roberto\",\n        layout: {},\n        zoom: 1,\n        edges: [],\n        focused: [],\n        errors: {}\n      };\n    }\n    close() {\n      console.log('A cerrar-->');\n    }\n    zoomOut() {\n      const increment = 0.1;\n      const minZoom = 0.25;\n      const actual = this.configuration.zoom;\n      if (actual <= minZoom) {\n        return;\n      }\n      this.configuration = assign({}, this.configuration, {\n        zoom: actual - increment\n      });\n    }\n    zoomIn() {\n      const increment = 0.1;\n      const maxZoom = 2;\n      const actual = this.configuration.zoom;\n      if (actual >= maxZoom) {\n        return;\n      }\n      this.configuration = assign({}, this.configuration, {\n        zoom: actual + increment\n      });\n    }\n    resetZoom() {\n      const actual = this.configuration.zoom;\n      if (actual === 1) {\n        return;\n      }\n      this.configuration = assign({}, this.configuration, {\n        zoom: 1\n      });\n    }\n    flowValuesChange($event) {\n      console.log('========> NUEVO FLOW en el papa->', $event);\n      this.configuration = assign({}, $event.flow);\n    }\n    updateConnectorType(value) {\n      this.configuration = assign({}, this.configuration, {\n        connectorType: value\n      });\n    }\n    updateTheme(value) {\n      this.configuration = assign({}, this.configuration, {\n        themeCss: value\n      });\n    }\n    // TODO: Mover esta función al componente designer-flow\n    //       esta función es similar a sendTest que se emite desde aqui\n    //       y se maneja en el componente que lo llama\n    validate() {\n      const errors = flow.validateFlow(this.blocks, this.configuration.edges);\n      console.table(errors);\n      this.configuration = assign({}, this.configuration, {\n        errors: errors\n      });\n      return errors;\n    }\n    focusBlocks(blockIds) {\n      this.configuration = assign({}, this.configuration, {\n        focused: blockIds\n      });\n    }\n    unfocusBlocks(blockIds) {\n      this.configuration = assign({}, this.configuration, {\n        focused: []\n      });\n    }\n    focusEdge(edge) {\n      const blockIds = [edge.source.block, edge.target.block];\n      this.configuration = assign({}, this.configuration, {\n        focused: blockIds\n      });\n    }\n    // TODO: Mover esta función al componente designer-flow\n    //       esta función es similar a sendTest que se emite desde aqui\n    //       y se maneja en el componente que lo llama\n    publish() {\n      const errors = this.validate();\n      if (Object.keys(errors).length > 0) {\n        console.warn('El flujo tiene errores y no puedo convertirlo');\n        return;\n      }\n      const checkpointCentric = flow.getCheckpointCentric(this.blocks, this.configuration.edges);\n      console.log('.. Centrado en Checkpoints -->', checkpointCentric);\n      // TODO: Falta mapear los ids al objeto del bloque completo\n      // con algo como :\n      //   const expanded = map(clustered, c => ({...c, path: c.path.map(p => find(this.blocks, ['uuid', p.block]))}))\n    }\n  }\n\n  AppComponent.ɵfac = function AppComponent_Factory(t) {\n    return new (t || AppComponent)();\n  };\n  AppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AppComponent,\n    selectors: [[\"my-app\"]],\n    decls: 75,\n    vars: 11,\n    consts: [[1, \"catalog\"], [3, \"click\"], [1, \"render\"], [3, \"blocks\", \"configuration\", \"flowValuesChange\", \"delete\"], [1, \"toolbar\"], [3, \"change\"], [\"value\", \"FLOWCHART\"], [\"value\", \"BEZIER\"], [\"value\", \"STRAIGHT\"], [\"value\", \"STATEMACHINE\"], [\"value\", \"basic-plain\"], [\"value\", \"basic-one\"], [\"value\", \"basic-two\"], [\"value\", \"basic-three\"], [\"value\", \"basic-four\"], [\"class\", \"error-msg\", 4, \"ngIf\"], [1, \"error-msg\"], [\"class\", \"error-item\", 4, \"ngFor\", \"ngForOf\"], [1, \"error-item\"], [\"class\", \"error-item focusable\", 3, \"mouseover\", \"mouseout\", 4, \"ngFor\", \"ngForOf\"], [1, \"error-item\", \"focusable\", 3, \"mouseover\", \"mouseout\"]],\n    template: function AppComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_1_listener() {\n          return ctx.insertBlock({\n            block: {\n              class: \"flow.start\"\n            }\n          });\n        });\n        i0.ɵɵtext(2, \" Agregar Comienzo \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_3_listener() {\n          return ctx.insertBlock({\n            block: {\n              class: \"flow.end\"\n            }\n          });\n        });\n        i0.ɵɵtext(4, \" Agregar Final \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(5, \" \\u00A0\\u00A0\\u00A0 \");\n        i0.ɵɵelementStart(6, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_6_listener() {\n          return ctx.insertBlock({\n            block: {\n              class: \"flow.signal\",\n              title: \"Contacto hizo un chat\"\n            }\n          });\n        });\n        i0.ɵɵtext(7, \" Se\\u00F1al chat \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_8_listener() {\n          return ctx.insertBlock({\n            block: {\n              class: \"flow.signal\",\n              title: \"Contacto abri\\u00F3 correo\"\n            }\n          });\n        });\n        i0.ɵɵtext(9, \" Se\\u00F1al Apertura \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_10_listener() {\n          return ctx.insertBlock({\n            block: {\n              class: \"flow.signal\",\n              title: \"Contacto hizo click en correo\"\n            }\n          });\n        });\n        i0.ɵɵtext(11, \" Se\\u00F1al Click en correo \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(12, \" \\u00A0\\u00A0\\u00A0 \");\n        i0.ɵɵelementStart(13, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_13_listener() {\n          return ctx.insertBlock({\n            block: {\n              class: \"flow.action\",\n              title: \"Enviar webhook\"\n            }\n          });\n        });\n        i0.ɵɵtext(14, \" Acci\\u00F3n Webhook \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_15_listener() {\n          return ctx.insertBlock({\n            block: {\n              class: \"flow.action\",\n              title: \"Enviar correo Cotizaci\\u00F3n\"\n            }\n          });\n        });\n        i0.ɵɵtext(16, \" Acci\\u00F3n Mensaje \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(17, \" \\u00A0\\u00A0\\u00A0 \");\n        i0.ɵɵelementStart(18, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_18_listener() {\n          return ctx.insertBlock({\n            block: {\n              class: \"flow.node\",\n              title: \"Parada\",\n              expireTime: 5\n            }\n          });\n        });\n        i0.ɵɵtext(19, \" Esperar respuesta \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(20, \" \\u00A0\\u00A0\\u00A0 \");\n        i0.ɵɵelementStart(21, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_21_listener() {\n          return ctx.insertBlock({\n            block: {\n              class: \"flow.note\",\n              title: \"Explicaci\\u00F3n\",\n              content: \"Esta nota usa markdown y sirve para explicar el flujo. Puede ser bien larga hasta cierto punto\"\n            }\n          });\n        });\n        i0.ɵɵtext(22, \" Agregar Nota \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(23, \"div\", 2)(24, \"ios-designer-render\", 3);\n        i0.ɵɵlistener(\"flowValuesChange\", function AppComponent_Template_ios_designer_render_flowValuesChange_24_listener($event) {\n          return ctx.flowValuesChange($event);\n        })(\"delete\", function AppComponent_Template_ios_designer_render_delete_24_listener($event) {\n          return ctx.deleteBlock($event);\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(25, \"div\", 4)(26, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_26_listener() {\n          return ctx.loadFromStorage();\n        });\n        i0.ɵɵtext(27, \"Cargar\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_28_listener() {\n          return ctx.save();\n        });\n        i0.ɵɵtext(29, \"Guardar\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_30_listener() {\n          return ctx.resetData();\n        });\n        i0.ɵɵtext(31, \"Close\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(32, \" \\u00A0\\u00A0 \");\n        i0.ɵɵelementStart(33, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_33_listener() {\n          return ctx.validate();\n        });\n        i0.ɵɵtext(34, \"Validar\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(35, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_35_listener() {\n          return ctx.publish();\n        });\n        i0.ɵɵtext(36, \"Publicar\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(37, \" \\u00A0\\u00A0 \");\n        i0.ɵɵelementStart(38, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_38_listener() {\n          return ctx.zoomIn();\n        });\n        i0.ɵɵtext(39, \"Zoom In\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(40, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_40_listener() {\n          return ctx.zoomOut();\n        });\n        i0.ɵɵtext(41, \"Zoom Out\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(42, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_42_listener() {\n          return ctx.resetZoom();\n        });\n        i0.ɵɵtext(43, \"Reset Zoom\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(44, \" \\u00A0\\u00A0 \\u00A0\\u00A0 \");\n        i0.ɵɵelementStart(45, \"select\", 5);\n        i0.ɵɵlistener(\"change\", function AppComponent_Template_select_change_45_listener($event) {\n          return ctx.updateConnectorType($event.target.value);\n        });\n        i0.ɵɵelementStart(46, \"option\", 6);\n        i0.ɵɵtext(47, \"Linea con esquinas\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(48, \"option\", 7);\n        i0.ɵɵtext(49, \"Curvas\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(50, \"option\", 8);\n        i0.ɵɵtext(51, \"L\\u00EDnea recta\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(52, \"option\", 9);\n        i0.ɵɵtext(53, \"Ligeramente curveada\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtext(54, \" \\u00A0\\u00A0 \");\n        i0.ɵɵelementStart(55, \"select\", 5);\n        i0.ɵɵlistener(\"change\", function AppComponent_Template_select_change_55_listener($event) {\n          return ctx.updateTheme($event.target.value);\n        });\n        i0.ɵɵelementStart(56, \"option\", 10);\n        i0.ɵɵtext(57, \"Plain\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(58, \"option\", 11);\n        i0.ɵɵtext(59, \"One\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(60, \"option\", 12);\n        i0.ɵɵtext(61, \"Two\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(62, \"option\", 13);\n        i0.ɵɵtext(63, \"Three\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(64, \"option\", 14);\n        i0.ɵɵtext(65, \"Four\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(66, AppComponent_div_66_Template, 3, 2, \"div\", 15);\n        i0.ɵɵtemplate(67, AppComponent_div_67_Template, 3, 2, \"div\", 15);\n        i0.ɵɵtemplate(68, AppComponent_div_68_Template, 3, 2, \"div\", 15);\n        i0.ɵɵtemplate(69, AppComponent_div_69_Template, 3, 2, \"div\", 15);\n        i0.ɵɵtemplate(70, AppComponent_div_70_Template, 3, 2, \"div\", 15);\n        i0.ɵɵtemplate(71, AppComponent_div_71_Template, 3, 2, \"div\", 15);\n        i0.ɵɵtemplate(72, AppComponent_div_72_Template, 3, 2, \"div\", 15);\n        i0.ɵɵtemplate(73, AppComponent_div_73_Template, 3, 2, \"div\", 15);\n        i0.ɵɵtemplate(74, AppComponent_div_74_Template, 3, 2, \"div\", 15);\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(24);\n        i0.ɵɵproperty(\"blocks\", ctx.blocks)(\"configuration\", ctx.configuration);\n        i0.ɵɵadvance(42);\n        i0.ɵɵproperty(\"ngIf\", ctx.configuration.errors && ctx.configuration.errors.minimunBlocks);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.configuration.errors && ctx.configuration.errors.uniqueComponent);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.configuration.errors && ctx.configuration.errors.acyclic);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.configuration.errors && ctx.configuration.errors.uniqueEntryNode);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.configuration.errors && ctx.configuration.errors.connections);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.configuration.errors && ctx.configuration.errors.nodeInEveryRoute);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.configuration.errors && ctx.configuration.errors.validSources);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.configuration.errors && ctx.configuration.errors.validSinks);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.configuration.errors && ctx.configuration.errors.expiration);\n      }\n    },\n    dependencies: [i1.NgForOf, i1.NgIf, i2.NgSelectOption, i2.ɵNgSelectMultipleOption, i3.DesignerRenderComponent],\n    styles: [\"p[_ngcontent-%COMP%]{font-family:Lato}.render[_ngcontent-%COMP%]{background-color:#f8f6f6}.error-msg[_ngcontent-%COMP%]{margin:10px;padding:10px;border:1px solid red}.error-item[_ngcontent-%COMP%]{margin:10px;padding:5px;border:4px dashed orange}.focusable[_ngcontent-%COMP%]{cursor:default}\"]\n  });\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}